{% extends "base.html" %}

{% block title %}Your Cart | ToolShare{% endblock %}

{% block content %}
  <h2 class="mb-4">Your Cart</h2>

  {% set cart = session.cart or {} %}
  {% if cart %}
    {% set ns = namespace(total=0) %}
    <div class="table-responsive">
      <table class="table table-bordered table-striped align-middle">
        <thead class="table-dark">
          <tr>
            <th>Tool</th>
            <th class="text-end">Price (Daily)</th>
            <th class="text-end">Quantity</th>
            <th class="text-end">Subtotal</th>
          </tr>
        </thead>
        <tbody>
          {% for tool_id, item in cart.items() %}
            {% set line_total = item.price * item.quantity %}
            {% set ns.total = ns.total + line_total %}
            <tr>
              <td>{{ item.name }}</td>
              <td class="text-end">${{ '%.2f'|format(item.price) }}</td>
              <td class="text-end">{{ item.quantity }}</td>
              <td class="text-end">${{ '%.2f'|format(line_total) }}</td>
            </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="3" class="text-end">Total:</th>
            <th class="text-end">${{ '%.2f'|format(ns.total) }}</th>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Checkout -->
    <form action="{{ url_for('create_checkout_session') }}" method="POST" class="mt-3">
      <button type="submit" class="btn btn-primary">Checkout with Stripe</button>
      <a href="{{ url_for('index') }}" class="btn btn-secondary ms-2">Back to Tools</a>
    </form>
  {% else %}
    <p>Your cart is empty.</p>
    <a href="{{ url_for('index') }}" class="btn btn-secondary mt-3">Back to Tools</a>
  {% endif %}
{% endblock %} 





