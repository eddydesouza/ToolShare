{% extends "base.html" %}
{% block title %}Home | ToolShare{% endblock %}

{% block content %}
<!-- How it works (above search) -->
<section class="py-5">
  <div class="container">
    <h2 class="h3 mb-4 text-center">How ToolShare Works</h2>
    <div class="row g-4 text-center">
      <div class="col-md-4">
        <div class="p-4 h-100 border rounded-3">
          <div class="display-6">1</div>
          <h3 class="h5 mt-2">Search</h3>
          <p class="text-muted mb-0">Find tools by name or category and check calendar availability.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-4 h-100 border rounded-3">
          <div class="display-6">2</div>
          <h3 class="h5 mt-2">Reserve</h3>
          <p class="text-muted mb-0">Pick available dates and add the tool to your cart.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-4 h-100 border rounded-3">
          <div class="display-6">3</div>
          <h3 class="h5 mt-2">Pickup & Go</h3>
          <p class="text-muted mb-0">Coordinate pickup, use the tool, and return it—simple.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Hero (search) -->
<section class="py-5 bg-light rounded-3">
  <div class="container">
    <div class="row align-items-center gy-4">
      <div class="col-lg-12">
        <h1 class="display-5 fw-bold mb-2">Find the right tool, right now.</h1>
        <p class="lead text-muted mb-4">Borrow from neighbors and local owners to finish your next project without buying new.</p>

        {% if session.user_id %}
          <!-- Logged-in: real form posts to /search -->
          <form action="{{ url_for('search_tools') }}" method="post" class="row gx-2 gy-2">
            <div class="col-md-7">
              <input type="text" name="search_term" class="form-control form-control-lg"
                     placeholder="e.g., drill, mower, ladder">
            </div>
            <div class="col-md-3">
              <select name="category" class="form-select form-select-lg">
                <option value="">All categories</option>
                {% if categories %}
                  {% for c in categories %}
                    <option value="{{ c }}">{{ c }}</option>
                  {% endfor %}
                {% endif %}
              </select>
            </div>
            <div class="col-md-2 d-grid">
              <button class="btn btn-primary btn-lg" type="submit">Search</button>
            </div>
          </form>
        {% else %}
          <!-- Logged-out: let them type, but redirect to login -->
          <form id="guestSearchForm" class="row gx-2 gy-2">
            <div class="col-md-7">
              <input type="text" id="guestSearchTerm" class="form-control form-control-lg"
                     placeholder="e.g., drill, mower, ladder">
            </div>
            <div class="col-md-3">
              <select id="guestCategory" class="form-select form-select-lg">
                <option value="">All categories</option>
                {% if categories %}
                  {% for c in categories %}
                    <option value="{{ c }}">{{ c }}</option>
                  {% endfor %}
                {% endif %}
              </select>
            </div>
            <div class="col-md-2 d-grid">
              <button type="submit" class="btn btn-primary btn-lg">Login to Search</button>
            </div>
          </form>
          <script>
            document.getElementById('guestSearchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const term = document.getElementById('guestSearchTerm').value || '';
                const cat  = document.getElementById('guestCategory').value || '';

                const params = new URLSearchParams();
                if (term) params.set('search_term', term);
                if (cat)  params.set('category', cat);

                let nextUrl = "{{ url_for('search_tools') }}";
                const qs = params.toString();
                if (qs) nextUrl += "?" + qs;

                window.location.href = "{{ url_for('login') }}?next=" + encodeURIComponent(nextUrl);
            });
          </script>

        {% endif %}

        <!-- Secondary CTAs -->
        <div class="d-flex gap-2 mt-3">
          <a href="{{ url_for('create_tool') }}" class="btn btn-outline-primary">Register a Tool</a>
          <a href="{{ url_for('search_tools') }}" class="btn btn-outline-secondary">Browse All</a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Why ToolShare -->
<section class="py-5">
  <div class="container">
    <h2 class="h3 mb-4 text-center">Why ToolShare?</h2>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="p-4 border rounded-3 h-100">
          <h3 class="h6 mb-2">Save Money</h3>
          <p class="text-muted mb-0">Rent what you need only when you need it—no storage or maintenance costs.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-4 border rounded-3 h-100">
          <h3 class="h6 mb-2">Save Time</h3>
          <p class="text-muted mb-0">Calendar availability lets you reserve specific dates in a click.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-4 border rounded-3 h-100">
          <h3 class="h6 mb-2">Support Community</h3>
          <p class="text-muted mb-0">Put idle tools to work and help neighbors finish their projects.</p>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
